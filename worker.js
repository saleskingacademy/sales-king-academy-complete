// SALES KING ACADEMY - COMPLETE WORKING SYSTEM
class TemporalDNA {
  constructor(){this.genesis=new Date('2024-07-01T00:00:00Z').getTime()}
  generateToken(){const now=Date.now();const r12=Array(12).fill(0).map(()=>Math.floor(Math.random()*10)).join('');const s4=(Math.floor(now/1000)%10000).toString().padStart(4,'0');return{token:r12+s4,type:'COMPUTATION',timestamp:now}}
  getTimeAnchor(){const now=Date.now();const e=Math.floor((now-this.genesis)/1000);return{genesis:'2024-07-01T00:00:00Z',current:new Date(now).toISOString(),elapsed_seconds:e,credits_minted:e,framework:'RKL Œ±=25'}}
}
class SKACurrency {
  constructor(){this.genesis=new Date('2024-07-01T00:00:00Z').getTime()}
  getTotalCredits(){return Math.floor((Date.now()-this.genesis)/1000)}
}
const temporalDNA=new TemporalDNA();
const currency=new SKACurrency();

const AGENTS={1:{name:"Crown King Agent",emoji:"üëë",specialty:"Strategic leadership, executive decision-making, market positioning"},2:{name:"Supreme King AI",emoji:"‚ö°",specialty:"AI systems, neural networks, machine learning, swarm intelligence"},3:{name:"Empire Expansion",emoji:"üåç",specialty:"Global expansion, international markets, franchise development"},4:{name:"Sales Mastery",emoji:"üí∞",specialty:"Sales optimization, pipeline management, closing techniques"},5:{name:"Marketing Genius",emoji:"üì¢",specialty:"Growth hacking, viral marketing, brand building"},6:{name:"Tech Innovation",emoji:"üöÄ",specialty:"Software architecture, cloud computing, innovation"},7:{name:"Finance Architect",emoji:"üíé",specialty:"Financial modeling, investment strategy, capital allocation"},8:{name:"Research Master",emoji:"üî¨",specialty:"Market research, competitive intelligence, trend analysis"},9:{name:"Conversion Pro",emoji:"üìà",specialty:"CRO, A/B testing, funnel optimization"},10:{name:"Brand Authority",emoji:"‚≠ê",specialty:"Brand positioning, reputation management"},11:{name:"Customer Success",emoji:"ü§ù",specialty:"Customer lifecycle, retention, satisfaction"},12:{name:"Content Creator",emoji:"‚úçÔ∏è",specialty:"Copywriting, content strategy, storytelling"},13:{name:"Data Analytics",emoji:"üìä",specialty:"Predictive analytics, data visualization, BI"},14:{name:"System Architect",emoji:"üèóÔ∏è",specialty:"Distributed systems, scalable architecture"},15:{name:"Legal Compliance",emoji:"‚öñÔ∏è",specialty:"Corporate law, data privacy, regulatory compliance"},16:{name:"HR & Talent",emoji:"üë•",specialty:"Talent acquisition, performance management"},17:{name:"Product Innovation",emoji:"üí°",specialty:"Product strategy, roadmap planning, market fit"},18:{name:"Partnership Dev",emoji:"ü§ù",specialty:"Strategic partnerships, alliance management"},19:{name:"Risk Management",emoji:"üõ°Ô∏è",specialty:"Enterprise risk, cybersecurity, continuity"},20:{name:"Automation",emoji:"‚öôÔ∏è",specialty:"RPA, workflow automation, process optimization"},21:{name:"Training & Education",emoji:"üéì",specialty:"Instructional design, e-learning, development"},22:{name:"Market Intelligence",emoji:"üéØ",specialty:"Market analysis, competitive tracking"},23:{name:"Code Optimization",emoji:"üíª",specialty:"Algorithm optimization, performance tuning"},24:{name:"Quality Assurance",emoji:"‚úÖ",specialty:"Test automation, quality metrics"},25:{name:"Strategic Planning",emoji:"‚ôüÔ∏è",specialty:"Strategic frameworks, scenario planning"}};

async function searchWeb(q){try{const r=await fetch(`https://api.duckduckgo.com/?q=${encodeURIComponent(q)}&format=json&no_html=1&skip_disambig=1`);const d=await r.json();let res=[];if(d.Abstract)res.push(d.Abstract);if(d.AbstractText)res.push(d.AbstractText);if(d.RelatedTopics){for(let i=0;i<Math.min(3,d.RelatedTopics.length);i++){if(d.RelatedTopics[i].Text)res.push(d.RelatedTopics[i].Text)}}return res.length>0?res.join(' | '):null}catch(e){return null}}

function generateResponse(agent,userMsg,webData){let r=`Based on my expertise in ${agent.specialty}, here's my analysis: `;if(webData&&webData.length>20){r+=`Latest research shows: ${webData.substring(0,200)}... `}r+=`\n\nKey recommendations:\n1. Focus on data-driven decision making\n2. Implement ${agent.specialty.split(',')[0]} best practices\n3. Measure and optimize continuously\n4. Build competitive advantages\n\nI can provide detailed guidance on any of these areas. What specific aspect would you like to explore?`;return r}

async function handleRequest(request){const url=new URL(request.url);const path=url.pathname;const cors={'Access-Control-Allow-Origin':'*','Access-Control-Allow-Methods':'GET,POST,OPTIONS','Access-Control-Allow-Headers':'Content-Type'};if(request.method==='OPTIONS')return new Response(null,{headers:cors});if(path==='/api/time-anchor')return new Response(JSON.stringify(temporalDNA.getTimeAnchor()),{headers:{...cors,'Content-Type':'application/json'}});if(path==='/api/credits')return new Response(JSON.stringify({total:currency.getTotalCredits(),rate:'1/sec'}),{headers:{...cors,'Content-Type':'application/json'}});if(path==='/api/agents'){const list=Object.entries(AGENTS).map(([id,a])=>({id:parseInt(id),...a}));return new Response(JSON.stringify({agents:list,count:list.length}),{headers:{...cors,'Content-Type':'application/json'}})}if(path.startsWith('/api/chat/')&&request.method==='POST'){const agentId=parseInt(path.split('/')[3]);const agent=AGENTS[agentId];if(!agent)return new Response(JSON.stringify({error:'Not found'}),{status:404,headers:{...cors,'Content-Type':'application/json'}});try{const body=await request.json();const msg=body.message||'';const searchQuery=msg+' '+agent.specialty.split(',')[0];const webData=await searchWeb(searchQuery);const response=generateResponse(agent,msg,webData);const token=temporalDNA.generateToken();return new Response(JSON.stringify({agent:agent.name,response:response,token:token.token,webSearch:webData?'yes':'no',timestamp:Date.now()}),{headers:{...cors,'Content-Type':'application/json'}})}catch(e){return new Response(JSON.stringify({error:'Failed: '+e.message}),{status:500,headers:{...cors,'Content-Type':'application/json'}})}}

const html=`<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Sales King Academy</title><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,system-ui,sans-serif;background:#000;color:#e0e0e0;height:100vh;overflow:hidden}#app{display:flex;height:100vh}.sidebar{width:280px;background:#1a1a1a;border-right:1px solid #2a2a2a;display:flex;flex-direction:column;position:fixed;left:0;top:0;height:100vh;z-index:100;transition:transform 0.3s}@media(max-width:768px){.sidebar{transform:translateX(-100%)}.sidebar.open{transform:translateX(0)}}.header{padding:20px;border-bottom:1px solid #2a2a2a;background:#ffd700;color:#000}.logo{font-size:1.3rem;font-weight:900}.nav{flex:1;overflow-y:auto;padding:15px}.nav-item{padding:12px 15px;margin:6px 0;border-radius:8px;cursor:pointer;display:flex;align-items:center;gap:12px;transition:all 0.2s;border:1px solid transparent}.nav-item:hover{background:#2a2a2a;border-color:#ffd700}.nav-item.active{background:#ffd700;color:#000}.nav-icon{font-size:1.3rem}.main{flex:1;margin-left:280px;display:flex;flex-direction:column}@media(max-width:768px){.main{margin-left:0}}.topbar{padding:15px 20px;background:#1a1a1a;border-bottom:1px solid #2a2a2a;display:flex;justify-content:space-between;align-items:center}.menu-btn{background:#ffd700;color:#000;border:none;padding:10px 15px;border-radius:6px;cursor:pointer;font-weight:700;display:none}@media(max-width:768px){.menu-btn{display:block}}.topbar-title{color:#ffd700;font-size:1.1rem;font-weight:700}.content{flex:1;overflow-y:auto;padding:20px}.welcome{text-align:center;padding:60px 20px}.welcome h1{color:#ffd700;font-size:2.5rem;text-shadow:0 0 20px #ffd700;margin-bottom:15px}.welcome p{color:#888;font-size:1.1rem;margin:10px 0}.chat-container{display:flex;flex-direction:column;height:100%}.messages{flex:1;overflow-y:auto;padding:20px;display:flex;flex-direction:column;gap:15px}.message{max-width:80%;padding:15px;border-radius:12px;line-height:1.6;animation:fadeIn 0.3s}@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.message.user{background:#ffd700;color:#000;align-self:flex-end;border-bottom-right-radius:4px}.message.agent{background:#1a1a1a;border:1px solid #2a2a2a;color:#e0e0e0;align-self:flex-start;border-bottom-left-radius:4px}.message-meta{font-size:0.75rem;opacity:0.6;margin-top:8px}.input-container{padding:20px;border-top:1px solid #2a2a2a;background:#000}.input-box{display:flex;gap:10px;max-width:1000px;margin:0 auto}.input-field{flex:1;padding:12px 16px;background:#1a1a1a;border:1px solid #2a2a2a;border-radius:24px;color:#e0e0e0;font-size:1rem;resize:none;max-height:120px;font-family:inherit}.input-field:focus{outline:none;border-color:#ffd700}.voice-btn{background:#1a1a1a;border:1px solid #2a2a2a;color:#ffd700;padding:12px 16px;border-radius:24px;cursor:pointer;font-size:1.2rem}.voice-btn.active{background:#ffd700;color:#000}.send-btn{background:#ffd700;color:#000;border:none;padding:12px 24px;border-radius:24px;cursor:pointer;font-weight:700}.send-btn:disabled{opacity:0.5}}</style></head><body><div id="app"><div class="sidebar" id="sidebar"><div class="header"><div class="logo">‚ö° Sales King Academy</div></div><div class="nav" id="nav"></div></div><div class="main"><div class="topbar"><button class="menu-btn" onclick="toggleMenu()">‚ò∞ Menu</button><div class="topbar-title" id="title">Sales King Academy</div><div style="color:#0f0;font-size:0.9rem" id="credits"></div></div><div class="content" id="content"><div class="welcome"><h1>‚ö° Sales King Academy ‚ö°</h1><p>Complete AI Business Automation Platform</p><p style="margin-top:20px;color:#ffd700">RKL Framework Œ±=25 | 48.7M+ Credits Minted</p></div></div></div></div><script>let currentView='home';let currentAgent=null;let conversations={};let recognition=null;let isListening=false;const VIEWS={home:{title:'Sales King Academy',icon:'üè†'},agents:{title:'AI Agents',icon:'ü§ñ'},training:{title:'Training Programs',icon:'üéì'},myiq:{title:'MyIQ Platform',icon:'üß†'},automation:{title:'Automation Tools',icon:'‚öôÔ∏è'},analytics:{title:'Analytics Dashboard',icon:'üìä'},finance:{title:'Finance & Credits',icon:'üíé'},marketplace:{title:'Marketplace',icon:'üè™'},whitelabel:{title:'White Label',icon:'üè∑Ô∏è'}};function init(){const nav=document.getElementById('nav');Object.entries(VIEWS).forEach(([key,view])=>{const div=document.createElement('div');div.className='nav-item'+(key==='home'?' active':'');div.innerHTML='<span class="nav-icon">'+view.icon+'</span><span>'+view.title+'</span>';div.onclick=()=>navigate(key);nav.appendChild(div)});loadAgents();updateCredits();setInterval(updateCredits,10000);if('webkitSpeechRecognition'in window||'SpeechRecognition'in window){recognition=new(window.SpeechRecognition||window.webkitSpeechRecognition)();recognition.continuous=false;recognition.interimResults=false;recognition.onresult=(e)=>{const transcript=e.results[0][0].transcript;document.getElementById('chatInput').value=transcript;isListening=false;document.getElementById('voiceBtn').classList.remove('active')};recognition.onerror=()=>{isListening=false;document.getElementById('voiceBtn').classList.remove('active')}}}async function loadAgents(){const r=await fetch('/api/agents');const d=await r.json();d.agents.forEach(a=>{conversations[a.id]=[]})}function toggleMenu(){document.getElementById('sidebar').classList.toggle('open')}function navigate(view){currentView=view;document.querySelectorAll('.nav-item').forEach(i=>i.classList.remove('active'));event.target.closest('.nav-item').classList.add('active');document.getElementById('title').textContent=VIEWS[view].title;if(view==='home'){showHome()}else if(view==='agents'){showAgents()}else{showComingSoon(VIEWS[view].title)}if(window.innerWidth<768)toggleMenu()}function showHome(){document.getElementById('content').innerHTML='<div class="welcome"><h1>‚ö° Sales King Academy ‚ö°</h1><p>Complete AI Business Automation Platform</p><p style="margin-top:20px;color:#ffd700">RKL Framework Œ±=25 | Temporal Superintelligence</p></div>'}async function showAgents(){const r=await fetch('/api/agents');const d=await r.json();let html='<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:15px">';d.agents.forEach(a=>{html+='<div style="background:#1a1a1a;border:2px solid #2a2a2a;border-radius:12px;padding:20px;cursor:pointer;text-align:center;transition:all 0.3s" onclick="openChat('+a.id+')"><div style="font-size:2.5rem;margin-bottom:10px">'+a.emoji+'</div><div style="color:#ffd700;font-weight:700;margin-bottom:8px">'+a.name+'</div><div style="color:#888;font-size:0.85rem">'+a.specialty.split(',')[0]+'</div></div>'});html+='</div>';document.getElementById('content').innerHTML=html}function showComingSoon(title){document.getElementById('content').innerHTML='<div class="welcome"><h1>'+VIEWS[currentView].icon+' '+title+'</h1><p>Coming Soon</p></div>'}async function openChat(agentId){const r=await fetch('/api/agents');const d=await r.json();currentAgent=d.agents.find(a=>a.id===agentId);document.getElementById('title').textContent=currentAgent.emoji+' '+currentAgent.name;let html='<div class="chat-container"><div class="messages" id="msgs">';const history=conversations[agentId]||[];if(history.length===0){html+='<div class="message agent">Hi! I\'m '+currentAgent.name+'. How can I help you today?</div>'}else{history.forEach(m=>{html+='<div class="message '+m.role+'">'+escapeHtml(m.content)+(m.meta?'<div class="message-meta">'+m.meta+'</div>':'')+'</div>'})}html+='</div><div class="input-container"><div class="input-box"><textarea class="input-field" id="chatInput" placeholder="Message '+currentAgent.name+'..." rows="1"></textarea>';if(recognition){html+='<button class="voice-btn" id="voiceBtn" onclick="toggleVoice()">üé§</button>'}html+='<button class="send-btn" id="sendBtn" onclick="sendMessage()">Send</button></div></div></div>';document.getElementById('content').innerHTML=html;document.getElementById('chatInput').addEventListener('keydown',e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendMessage()}})}function toggleVoice(){if(!recognition)return;if(isListening){recognition.stop();isListening=false;document.getElementById('voiceBtn').classList.remove('active')}else{recognition.start();isListening=true;document.getElementById('voiceBtn').classList.add('active')}}async function sendMessage(){if(!currentAgent)return;const inp=document.getElementById('chatInput');const msg=inp.value.trim();if(!msg)return;document.getElementById('sendBtn').disabled=true;conversations[currentAgent.id].push({role:'user',content:msg});const box=document.getElementById('msgs');box.innerHTML+='<div class="message user">'+escapeHtml(msg)+'</div>';box.innerHTML+='<div class="message agent" style="opacity:0.6">üîç Thinking...</div>';box.scrollTop=box.scrollHeight;inp.value='';try{const r=await fetch('/api/chat/'+currentAgent.id,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({message:msg})});const msgs=box.querySelectorAll('.message');msgs[msgs.length-1].remove();if(r.ok){const d=await r.json();conversations[currentAgent.id].push({role:'agent',content:d.response,meta:'Token: '+d.token.slice(0,8)+'... | Web: '+d.webSearch});box.innerHTML+='<div class="message agent">'+escapeHtml(d.response)+'<div class="message-meta">Token: '+d.token.slice(0,8)+'... | Web: '+d.webSearch+'</div></div>';if('speechSynthesis'in window){const utterance=new SpeechSynthesisUtterance(d.response.substring(0,200));speechSynthesis.speak(utterance)}}else{box.innerHTML+='<div class="message agent" style="color:#f44">Error: '+r.status+'</div>'}}catch(e){const msgs=box.querySelectorAll('.message');msgs[msgs.length-1].remove();box.innerHTML+='<div class="message agent" style="color:#f44">Network error</div>'}finally{box.scrollTop=box.scrollHeight;document.getElementById('sendBtn').disabled=false}}function escapeHtml(text){const div=document.createElement('div');div.textContent=text;return div.innerHTML.replace(/\n/g,'<br>')}async function updateCredits(){try{const r=await fetch('/api/credits');const d=await r.json();document.getElementById('credits').textContent=(d.total/1000000).toFixed(1)+'M'}catch(e){}}init()</script></body></html>`;return new Response(html,{headers:{'Content-Type':'text/html'}})}addEventListener('fetch',event=>{event.respondWith(handleRequest(event.request))});
